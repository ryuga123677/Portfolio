<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

        <title>Babylon.js sample code</title>

        <!-- Babylon.js -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.6.2/dat.gui.min.js"></script>
        <script src="https://assets.babylonjs.com/generated/Assets.js"></script>
        <script src="https://cdn.babylonjs.com/recast.js"></script>
        <script src="https://cdn.babylonjs.com/ammo.js"></script>
        <script src="https://cdn.babylonjs.com/havok/HavokPhysics_umd.js"></script>
        <script src="https://cdn.babylonjs.com/cannon.js"></script>
        <script src="https://cdn.babylonjs.com/Oimo.js"></script>
        <script src="https://cdn.babylonjs.com/earcut.min.js"></script>
        <script src="https://cdn.babylonjs.com/babylon.js"></script>
        <script src="https://cdn.babylonjs.com/materialsLibrary/babylonjs.materials.min.js"></script>
        <script src="https://cdn.babylonjs.com/proceduralTexturesLibrary/babylonjs.proceduralTextures.min.js"></script>
        <script src="https://cdn.babylonjs.com/postProcessesLibrary/babylonjs.postProcess.min.js"></script>
        <script src="https://cdn.babylonjs.com/loaders/babylonjs.loaders.js"></script>
        <script src="https://cdn.babylonjs.com/serializers/babylonjs.serializers.min.js"></script>
        <script src="https://cdn.babylonjs.com/gui/babylon.gui.min.js"></script>
        <script src="https://cdn.babylonjs.com/inspector/babylon.inspector.bundle.js"></script>

        <style>
            html, body {
                overflow: hidden;
                width: 100%;
                height: 100%;
                margin: 0;
                padding: 0;
            }

            #renderCanvas {
                width: 100%;
                height: 100%;
                touch-action: none;
            }
            
            #canvasZone {
                width: 100%;
                height: 100%;
            }

        </style>
    </head>
<body>
    <div id="canvasZone"><canvas id="renderCanvas">
   
    </canvas></div>
    <script>
        var canvas = document.getElementById("renderCanvas");
      


        var startRenderLoop = function (engine, canvas) {
            engine.runRenderLoop(function () {
                if (sceneToRender && sceneToRender.activeCamera) {
                    sceneToRender.render();
                }
            });
        }

        var engine = null;
        var scene = null;
        var sceneToRender = null;
        var createDefaultEngine = function() { return new BABYLON.Engine(canvas, true, { preserveDrawingBuffer: true, stencil: true,  disableWebGL2Support: false}); };
        var createScene = function () {
    // This creates a basic Babylon Scene object (non-mesh)
    var scene = new BABYLON.Scene(engine);

    // This creates and positions a free camera (non-mesh)
   var camera = new BABYLON.ArcRotateCamera("camera",0, 1.5, 1, new BABYLON.Vector3(1, 8.5, -38), scene);
    
    // This targets the camera to scene origin
 // camera.setTarget(BABYLON.Vector3.zero());

    // This attaches the camera to the canvas
    camera.attachControl(canvas, true);
    camera.radius=5;
    var lampon=false;
    var  lamp=new BABYLON.PointLight("lamp", new BABYLON.Vector3(-5.03, 1.47,-47.67), scene);
    lamp.diffuse=new BABYLON.Color3(1,1,0);
    lamp.intensity=0;
   
    BABYLON.SceneLoader.ImportMeshAsync(null,"./models/","portfolio.glb",scene,function(newMeshes){
        newMeshes[0]="Project";
         
         scene.onPointerDown = function castRay(){
             var ray = scene.createPickingRay(scene.pointerX, scene.pointerY, BABYLON.Matrix.Identity(), camera);	
            
     
             var hit = scene.pickWithRay(ray);
             if(hit.pickedMesh.name=="car_game" && hit.pickedMesh)
             {
                 console.log("true");
             
                 
                 createGUIButton();
             }
             
             if(hit.pickedMesh.name=="Lamp" && hit.pickedMesh && lampon==false)
             {
                 lampon=true;
                 
             lamp.intensity=100;
          
                 
     
     
                 console.log("true");
                
            
             
                
             }
             else if(hit.pickedMesh.name=="Lamp" && hit.pickedMesh && lampon==true)
             {
                 lampon=false;
                 lamp.intensity=0;
     
             }
        
     
         }   
     })
     
    camera.lowerRadiusLimit=0;
    camera.upperRadiusLimit=8;
   


    // This creates a light, aiming 0,1,0 - to the sky (non-mesh)
    var bulb1 = new BABYLON.SpotLight("light1", new BABYLON.Vector3(-5.74, 13.84,-36.57),new BABYLON.Vector3(-0.91, -0.42,-0.0),2,20, scene);
    var emitterPosition = new BABYLON.Vector3(10, 1, 10);
    var emitterMesh = new BABYLON.Mesh("emitterMesh", scene);
    emitterMesh.position = new BABYLON.Vector3(0, 0, 1); // Set the initial position of the emitter mesh
    
    

    // Default intensity is 1. Let's dim the light a small amount
   bulb1.intensity =1000;
   var bulb2 = new BABYLON.PointLight("light2", new BABYLON.Vector3(.6, 15.09,-47.06), scene);
  bulb2.intensity =200;
var bulb3 = new BABYLON.PointLight("light3", new BABYLON.Vector3(.09, 15.63,-35.14), scene);
bulb3.intensity =500;
var bulb4 = new BABYLON.PointLight("light4", new BABYLON.Vector3(1.38, 15.79,-46.75), scene);
bulb4.intensity =300;



 // scene.debugLayer.show({
   //    embedMode: true,
   // });
   
  
    



function createGUIButton(){
    //Creates a gui label to display the cannon
    let guiCanvas = BABYLON.GUI.AdvancedDynamicTexture.CreateFullscreenUI("UI");
    let guiButton = BABYLON.GUI.Button.CreateSimpleButton("guiButton", "Open Project");
    guiButton.width = "150px"
    guiButton.height = "40px";
    guiButton.color = "white";
    guiButton.cornerRadius = 5;
    guiButton.background = "green";
    guiButton.onPointerUpObservable.add(function() {
        guiCanvas.dispose();
    });
    guiButton.verticalAlignment = BABYLON.GUI.Control.VERTICAL_ALIGNMENT_CENTER;
    guiCanvas.addControl(guiButton);
}

  //mesh.position.y=2;

    return scene;
};
                window.initFunction = async function() {
                    
                    
                    
                    var asyncEngineCreation = async function() {
                        try {
                        return createDefaultEngine();
                        } catch(e) {
                        console.log("the available createEngine function failed. Creating the default engine instead");
                        return createDefaultEngine();
                        }
                    }

                    window.engine = await asyncEngineCreation();
        if (!engine) throw 'engine should not be null.';
        startRenderLoop(engine, canvas);
        window.scene = createScene();};
        initFunction().then(() => {sceneToRender = scene                    
        });

        // Resize
        window.addEventListener("resize", function () {
            engine.resize();
        });
    </script>
</body>
</html>
